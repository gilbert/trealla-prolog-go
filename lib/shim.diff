diff --git a/Makefile b/Makefile
index fb11da04..fa3d082c 100644
--- a/Makefile
+++ b/Makefile
@@ -1,6 +1,6 @@
 GIT_VERSION := "$(shell git describe --abbrev=4 --dirty --always --tags)"
 
-CFLAGS = -Isrc -I/usr/local/include -DVERSION='$(GIT_VERSION)' -O3 \
+CFLAGS = -Isrc -I/usr/local/include -DVERSION='$(GIT_VERSION)' \
 	-funsigned-char $(OPT) -D_GNU_SOURCE -Wall -Wextra \
 	-Wno-deprecated-declarations \
 	-Wno-unused-function -Wno-unused-parameter \
@@ -37,7 +37,7 @@ LDFLAGS += -flto=$(LTO)
 endif
 
 ifdef WASI
-CFLAGS += -D_WASI_EMULATED_MMAN -D_WASI_EMULATED_SIGNAL -O0
+CFLAGS += -D_WASI_EMULATED_MMAN -D_WASI_EMULATED_SIGNAL
 LDFLAGS += -lwasi-emulated-mman -lwasi-emulated-signal
 endif
 
@@ -85,6 +85,8 @@ LIBOBJECTS +=  \
 	library/sqlite3.o \
 	library/sqlite3_register.o \
 	library/ugraphs.o \
+	library/json.o \
+	library/wasm_toplevel.o \
 	library/when.o
 
 SRCOBJECTS += src/imath/imath.o
diff --git a/src/library.c b/src/library.c
index bd69d83e..3d1714fe 100644
--- a/src/library.c
+++ b/src/library.c
@@ -46,6 +46,11 @@ extern unsigned int library_sqlite3_register_pl_len;
 //extern unsigned char library_clpz_pl[];
 //extern unsigned int library_clpz_pl_len;
 
+extern unsigned char library_json_pl[];
+extern unsigned int library_json_pl_len;
+extern unsigned char library_wasm_toplevel_pl[];
+extern unsigned int library_wasm_toplevel_pl_len;
+
 library g_libs[] = {
 	 {"apply", library_apply_pl, &library_apply_pl_len},
 	 {"assoc", library_assoc_pl, &library_assoc_pl_len},
@@ -71,5 +76,8 @@ library g_libs[] = {
 	 //{"clpb", library_clpb_pl, &library_clpb_pl_len},
 	 //{"clpz", library_clpz_pl, &library_clpz_pl_len},
 
+	 {"json", library_json_pl, &library_json_pl_len},
+	 {"wasm_toplevel", library_wasm_toplevel_pl, &library_wasm_toplevel_pl_len},
+
 	 {0}
 };
