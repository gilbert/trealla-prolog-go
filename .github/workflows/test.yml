  name: Test

  on:
    push:
      tags:
        - "v*"
      branches:
        - "*"
    pull_request:
    release:
      types: [created]

  jobs:
    test:
      name: Build & Test
      runs-on: ${{ matrix.os }}
      strategy:
        fail-fast: false
        matrix:
          os:
            - ubuntu-latest
            - macos-latest
            - windows-latest
      steps:
        - uses: actions/checkout@v3
        # wasmtime build error workaround
        # - run: choco install mingw --version 11.2.0.07112021 --allow-downgrade
        #   if: matrix.os == 'windows-latest'
        - name: Install Go
          uses: actions/setup-go@v3
          with:
            go-version: "1.20"
        - name: Deps
          run: go get ./trealla
        - name: Build
          run: go build -a ./trealla
        - name: Test
          run: go test -a -v ./trealla --skipslow
